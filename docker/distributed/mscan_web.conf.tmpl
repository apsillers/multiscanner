ServerName msweb

{{ if eq (getenv "MS_USE_SSL") "true" }}
# HTTP to HTTPS redirect
<VirtualHost *:{{ getenv "MS_HTTP_PORT" "80" }}>
    ServerName msweb
    Redirect permanent / https://msweb/ 
</VirtualHost>

Listen {{ getenv "MS_HTTPS_PORT" "443" }}
{{end}}

# main listener, on HTTP or optionally HTTPS port
<VirtualHost *:{{ if eq (getenv "MS_USE_SSL") "true" }}{{ getenv "MS_HTTPS_PORT" "443" }}{{else}}{{ getenv "MS_HTTP_PORT" "80" }}{{end}}>
    ServerName msweb

{{ if eq (getenv "MS_USE_SSL") "true" }}
    LoadModule ssl_module modules/mod_ssl.so
    SSLEngine on
    SSLCertificateFile /usr/local/apache2/certs/msweb.crt
    SSLCertificateKeyFile /usr/local/apache2/certs/msweb.key
{{ end }}

    LoadModule wsgi_module {{ getenv "MOD_WSGI_LOCATION" }}
    WSGIDaemonProcess mscan_web threads=5 python-path=/opt/multiscanner/web
    WSGIScriptAlias / /opt/multiscanner/docker/distributed/mscan_web.wsgi

    <Directory /opt/multiscanner>
        WSGIProcessGroup mscan_web
        WSGIScriptReloading On
        WSGIApplicationGroup %{GLOBAL}
        Order deny,allow
        Allow from all
        Require all granted
    </Directory>

    Alias /static/ /opt/multiscanner/web/static/
    <Directory /opt/multiscanner/web/static>
            Order allow,deny
            Allow from all
            Require all granted
    </Directory>

    Alias /templates/ /opt/multiscanner/web/templates/
    <Directory /opt/multiscanner/web/templates>
            Order allow,deny
            Allow from all
            Require all granted
    </Directory>

    ErrorLog /var/log/mscanweb/error.log
    LogLevel debug
    CustomLog /var/log/mscanweb/access.log combined
</VirtualHost>
